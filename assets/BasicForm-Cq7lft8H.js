import{h as Q,m as W,n as ne,k as Z,b as oe,o as le,_ as se}from"./index-D48T_xji.js";import{K as n,Z as q,k as ae,r as S,e as ue,c as F,w as re,o as ie,a0 as I,a4 as p,P as r,a3 as l,a2 as k,ae as fe,af as ce,O as $,a1 as R,F as A,$ as G,s as U,ad as de,q as K,j as V,_ as M,a9 as pe,M as Y}from"./vue-Beri1Aun.js";import{s as me}from"./lodash-es-Wid6WkHk.js";import{p as T}from"./propTypes-BvihHqXo.js";import{Q as _e,Y as ge,x as be}from"./vicons-antd-mqTWGFU9.js";import{L as ye,M as ve,e as ke,f as Be,r as Oe,g as Pe,V as we,W as Se,s as Fe,h as he,B as Ce,d as Ve}from"./naive-ui-C208m6FU.js";function Me(e){return e==="NInput"?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}function Ne({emit:e,getProps:O,formModel:b,getSchema:P,formElRef:m,defaultFormModel:_,loadingSub:i,handleFormValues:a}){async function o(){return n(m)?.validate()}async function y(s){s&&s.preventDefault(),i.value=!0;const{submitFunc:d}=n(O);if(d&&Q(d))return await d(),i.value=!1,!1;if(!n(m))return!1;try{await o();const f=h();return i.value=!1,e("submit",f),f}catch(f){return e("submit",!1),i.value=!1,console.error(f),!1}}async function B(){await n(m)?.restoreValidation()}async function N(){const{resetFunc:s,submitOnReset:d}=n(O);if(s&&Q(s)&&await s(),!n(m))return;Object.keys(b).forEach(C=>{b[C]=n(_)[C]||null}),await B();const f=a(q(n(b)));e("reset",f),d&&await y()}function h(){return n(m)?a(q(n(b))):{}}async function j(s){const d=n(P).map(g=>g.field).filter(Boolean);Object.keys(s).forEach(g=>{const f=s[g];d.includes(g)&&(b[g]=f)})}function v(s){i.value=s}return{handleSubmit:y,validate:o,resetFields:N,getFieldsValue:h,clearValidate:B,setFieldsValue:j,setLoading:v}}function je({defaultFormModel:e,getSchema:O,formModel:b}){function P(_){if(!ne(_))return{};const i={};for(const a of Object.entries(_)){let[,o]=a;const[y]=a;!y||Z(o)&&o.length===0||Q(o)||W(o)||(oe(o)&&(o=o.trim()),me(i,y,o))}return i}function m(){const _=n(O),i={};_.forEach(a=>{const{defaultValue:o}=a;W(o)||(i[a.field]=o,b[a.field]=o)}),e.value=i}return{handleFormValues:P,initDefault:m}}const De={labelWidth:{type:[Number,String],default:80},schemas:{type:[Array],default:()=>[]},layout:{type:String,default:"inline"},inline:{type:Boolean,default:!1},size:{type:String,default:"medium"},labelPlacement:{type:String,default:"left"},isFull:{type:Boolean,default:!0},showActionButtonGroup:T.bool.def(!0),showResetButton:T.bool.def(!0),resetButtonOptions:Object,showSubmitButton:T.bool.def(!0),submitButtonOptions:Object,showAdvancedButton:T.bool.def(!0),submitButtonText:{type:String,default:"查询"},resetButtonText:{type:String,default:"重置"},gridProps:Object,giProps:Object,baseGridStyle:{type:Object},collapsed:{type:Boolean,default:!1},collapsedRows:{type:Number,default:1}},Re=ae({name:"BasicForm",components:{DownOutlined:be,UpOutlined:ge,QuestionCircleOutlined:_e},props:{...De},emits:["reset","submit","register"],setup(e,{emit:O,attrs:b}){const P=S({}),m=ue({}),_=S({}),i=S(null),a=S(null),o=S(!0),y=S(!1),B=S(!1),N=F(()=>Object.assign({size:e.size,type:"primary"},e.submitButtonOptions)),h=F(()=>Object.assign({size:e.size,type:"default"},e.resetButtonOptions));function j(u){const w=u.componentProps??{},D=u.component;return{clearable:!0,placeholder:Me(n(D)),...w}}const v=F(()=>{const u={...e,...n(_)},w={rules:{}};return(u.schemas||[]).forEach(E=>{E.rules&&Z(E.rules)&&(w.rules[E.field]=E.rules)}),{...u,...n(w)}}),s=F(()=>{const{layout:u}=n(v);return u==="inline"}),d=F(()=>{const{gridProps:u}=n(v);return{...u,collapsed:s.value?o.value:!1,responsive:"screen"}}),g=F(()=>({...b,...e,...n(v)})),f=F(()=>{const u=n(i)||n(v).schemas;for(const w of u){const{defaultValue:D}=w;D&&(w.defaultValue=D)}return u}),{handleFormValues:C,initDefault:z}=je({defaultFormModel:P,getSchema:f,formModel:m}),{handleSubmit:t,validate:c,resetFields:L,getFieldsValue:H,clearValidate:J,setFieldsValue:X}=Ne({emit:O,getProps:v,formModel:m,getSchema:f,formElRef:a,defaultFormModel:P,loadingSub:y,handleFormValues:C});function x(){o.value=!o.value}async function ee(u){_.value=le(n(_)||{},u)}const te={getFieldsValue:H,setFieldsValue:X,resetFields:L,validate:c,clearValidate:J,setProps:ee,submit:t};return re(()=>f.value,u=>{n(B)||u?.length&&(z(),B.value=!0)}),ie(()=>{z(),O("register",te)}),{formElRef:a,formModel:m,getGrid:d,getProps:v,getBindValue:g,getSchema:f,getSubmitBtnOptions:N,getResetBtnOptions:h,handleSubmit:t,resetFields:L,loadingSub:y,isInline:s,getComponentProps:j,unfoldToggle:x}}});function Ue(e,O,b,P,m,_){const i=I("QuestionCircleOutlined"),a=he,o=Fe,y=Pe,B=Oe,N=Be,h=Se,j=we,v=ke,s=ve,d=Ce,g=I("DownOutlined"),f=I("UpOutlined"),C=ye,z=Ve;return r(),p(z,U(e.getBindValue,{model:e.formModel,ref:"formElRef"}),{default:l(()=>[k(C,fe(ce(e.getGrid)),{default:l(()=>[(r(!0),$(A,null,G(e.getSchema,t=>(r(),p(s,U({ref_for:!0},t.giProps,{key:t.field}),{default:l(()=>[k(v,{label:t.label,path:t.field},de({default:l(()=>[t.slot?K(e.$slots,t.slot,{key:0,model:e.formModel,field:t.field,value:e.formModel[t.field]},void 0,!0):t.component==="NCheckbox"?(r(),p(N,{key:1,value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c},{default:l(()=>[k(B,null,{default:l(()=>[(r(!0),$(A,null,G(t.componentProps.options,c=>(r(),p(y,{key:c.value,value:c.value,label:c.label},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])):t.component==="NRadioGroup"?(r(),p(j,{key:2,value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c},{default:l(()=>[k(B,null,{default:l(()=>[(r(!0),$(A,null,G(t.componentProps.options,c=>(r(),p(h,{key:c.value,value:c.value},{default:l(()=>[V(M(c.label),1)]),_:2},1032,["value"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])):(r(),p(pe(t.component),U({key:3,ref_for:!0},e.getComponentProps(t),{value:e.formModel[t.field],"onUpdate:value":c=>e.formModel[t.field]=c,class:{isFull:t.isFull!=!1&&e.getProps.isFull}}),null,16,["value","onUpdate:value","class"])),t.suffix?K(e.$slots,t.suffix,{key:4,model:e.formModel,field:t.field,value:e.formModel[t.field]},void 0,!0):R("",!0)]),_:2},[t.labelMessage?{name:"label",fn:l(()=>[V(M(t.label)+" ",1),k(o,{trigger:"hover",style:Y(t.labelMessageStyle)},{trigger:l(()=>[k(a,{size:"18",class:"text-gray-400 cursor-pointer"},{default:l(()=>[k(i)]),_:1})]),default:l(()=>[V(" "+M(t.labelMessage),1)]),_:2},1032,["style"])]),key:"0"}:void 0]),1032,["label","path"])]),_:2},1040))),128)),e.getProps.showActionButtonGroup?(r(),p(s,{key:0,span:e.isInline?"":24,suffix:!!e.isInline},{default:l(({overflow:t})=>[k(B,{align:"center",justify:e.isInline?"end":"start",style:Y({"margin-left":`${e.isInline?12:e.getProps.labelWidth}px`})},{default:l(()=>[e.getProps.showSubmitButton?(r(),p(d,U({key:0},e.getSubmitBtnOptions,{onClick:e.handleSubmit,loading:e.loadingSub,"attr-type":"submit"}),{default:l(()=>[V(M(e.getProps.submitButtonText),1)]),_:1},16,["onClick","loading"])):R("",!0),e.getProps.showResetButton?(r(),p(d,U({key:1},e.getResetBtnOptions,{onClick:e.resetFields}),{default:l(()=>[V(M(e.getProps.resetButtonText),1)]),_:1},16,["onClick"])):R("",!0),e.isInline&&e.getProps.showAdvancedButton?(r(),p(d,{key:2,type:"primary",text:"","icon-placement":"right",onClick:e.unfoldToggle},{icon:l(()=>[t?(r(),p(a,{key:0,size:"14",class:"unfold-icon"},{default:l(()=>[k(g)]),_:1})):(r(),p(a,{key:1,size:"14",class:"unfold-icon"},{default:l(()=>[k(f)]),_:1}))]),default:l(()=>[V(" "+M(t?"展开":"收起"),1)]),_:2},1032,["onClick"])):R("",!0)]),_:2},1032,["justify","style"])]),_:1},8,["span","suffix"])):R("",!0)]),_:3},16)]),_:3},16,["model"])}const Ge=se(Re,[["render",Ue],["__scopeId","data-v-c36fe6fa"]]);export{Ge as _};
