import{k as K,r as _,o as R,n as y,E as $,O as f,P as v,Q as s,a2 as a,K as t,a3 as l,a1 as k,F,$ as H,R as L,l as x,a7 as P,a5 as z,a6 as M,a8 as U,I,_ as N}from"./vue-Beri1Aun.js";import{d as j}from"./pinia-BamTO2dA.js";import{t as O,B as d,h as u}from"./naive-ui-C208m6FU.js";import{M as q,f as Q,g as T,h as W,i as G}from"./vicons-antd-mqTWGFU9.js";import{_ as X}from"./index-lkNvZSEY.js";import"./lodash-es-Wid6WkHk.js";import"./vue-quill-BGJDKBN8.js";import"./vue-router-SJ7HX0Zq.js";import"./vicons-ionicons5-7CS79G9p.js";const Y=j("chat",{state:()=>({messages:[],inputContent:"",isStreaming:!1}),actions:{addMessage(o){this.messages.push(o),localStorage.setItem("chatMessages",JSON.stringify(this.messages))},clearChat(){this.messages=[],localStorage.removeItem("chatMessages")},updateInput(o){this.inputContent=o},setStreaming(o){this.isStreaming=o},initChat(){const o=localStorage.getItem("chatMessages");o&&(this.messages=JSON.parse(o))}}});async function Z(o){const m="https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation";try{const e=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer sk-329c16a4c5624803b6dc85a5e6a8b31f"},body:JSON.stringify({model:"qwen-turbo",input:{messages:o},stream:!1,result_format:"text"})});if(!e.ok)throw new Error(`HTTP é”™è¯¯ï¼š${e.status}`);const p=(await e.json()).output?.text||"AI æœªè¿”å›å†…å®¹";return async function*(){yield p}()}catch{throw new Error("é€šä¹‰åƒé—®è°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key æˆ–ç½‘ç»œ")}}async function ee(o,m="dashscope"){return Z(o)}const te={class:"ai-chat-container"},se={class:"chat-header"},ae={class:"header-left"},ne={class:"header-actions"},oe={class:"message-list"},ie={key:0,class:"welcome-card"},le={class:"message-content"},re={class:"message-time"},ce={key:1,class:"loading-item"},de={class:"chat-input-area"},ue={class:"input-wrapper"},me=["disabled","onKeydown"],ge={class:"button-group"},pe={class:"model-switch"},he=K({__name:"index",setup(o){const m=_("/ai-avatar.png");_("/user-avatar.png");const e=Y(),g=_(null),p=_("dashscope");R(()=>{e.initChat(),y(()=>b())});const w=async()=>{const r=e.inputContent.trim();if(!r)return;const n={id:Date.now().toString(),role:"user",content:r,timestamp:Date.now()};e.messages=[...e.messages,n],localStorage.setItem("chatMessages",JSON.stringify(e.messages));const i=Date.now().toString()+"-ai",J={id:i,role:"assistant",content:"åŠ è½½ä¸­...",timestamp:Date.now()};e.messages=[...e.messages,J],e.isStreaming=!0,e.inputContent="",y(()=>b());try{const S=e.messages.slice(0,-1).map(c=>({role:c.role,content:c.content})),h=await ee(S,p.value);let C="";for await(const c of h)C+=c;e.messages=e.messages.map(c=>c.id===i?{...c,content:C}:c),localStorage.setItem("chatMessages",JSON.stringify(e.messages))}catch(S){e.messages=e.messages.map(h=>h.id===i?{...h,content:S.message||"AIå›å¤å¤±è´¥ï¼Œè¯·é‡è¯•~"}:h)}finally{e.isStreaming=!1,y(()=>b())}},D=()=>{e.inputContent+=`
`},b=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)},E=()=>{y(()=>b())},A=()=>{},B=()=>{document.fullscreenElement?document.exitFullscreen().catch(r=>console.log("é€€å‡ºå…¨å±å¤±è´¥:",r)):document.documentElement.requestFullscreen().catch(r=>console.log("å…¨å±å¤±è´¥:",r))},V=r=>new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"});return $(()=>{window.removeEventListener("resize",E)}),(r,n)=>(v(),f("div",te,[s("div",se,[s("div",ae,[a(t(O),{src:m.value,class:"header-avatar"},null,8,["src"]),n[2]||(n[2]=s("div",{class:"header-info"},[s("span",{class:"chat-title"},"æ™ºèƒ½åŠ©æ‰‹ï¼ˆé€šä¹‰åƒé—®ï¼‰"),s("span",{class:"online-status"},"åœ¨çº¿")],-1))]),s("div",ne,[a(t(d),{circle:"",size:"tiny",onClick:A,class:"header-btn",style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white"}},{default:l(()=>[a(t(u),{size:"16"},{default:l(()=>[a(t(q))]),_:1})]),_:1}),a(t(d),{circle:"",size:"tiny",onClick:B,class:"header-btn",style:{background:"rgba(255,255,255,0.1)",border:"none",color:"white"}},{default:l(()=>[a(t(u),{size:"16"},{default:l(()=>[a(t(Q))]),_:1})]),_:1}),a(t(d),{circle:"",size:"tiny",onClick:t(e).clearChat,class:"header-btn close-btn",style:{background:"rgba(239,68,68,0.2)",border:"none",color:"#fca5a5"}},{default:l(()=>[a(t(u),{size:"16"},{default:l(()=>[a(t(T))]),_:1})]),_:1},8,["onClick"])])]),s("div",{class:"chat-content",ref_key:"chatHistoryRef",ref:g},[s("div",oe,[t(e).messages.length===0?(v(),f("div",ie,[...n[3]||(n[3]=[s("div",{class:"welcome-title"},"ğŸ‘‹ æ¬¢è¿ä½¿ç”¨æ™ºèƒ½åŠ©æ‰‹",-1),s("div",{class:"welcome-desc"},"æˆ‘æ˜¯åŸºäºé€šä¹‰åƒé—®çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œå¯å¸®ä½ è§£ç­”é—®é¢˜ã€æä¾›å»ºè®®ï¼Œéšæ—¶ä¸ºä½ æœåŠ¡ï¼",-1)])])):k("",!0),(v(!0),f(F,null,H(t(e).messages,i=>(v(),f("div",{key:i.id,class:I(`message-item ${i.role}`)},[s("div",{class:I(`message-bubble ${i.role}-bubble`)},[s("div",le,N(i.content),1),s("div",re,N(V(i.timestamp)),1)],2)],2))),128)),t(e).isStreaming?(v(),f("div",ce,[a(t(O),{src:m.value,class:"message-avatar ai-avatar"},null,8,["src"]),n[4]||(n[4]=L('<div class="message-bubble assistant-bubble loading-bubble" data-v-36864438><div class="loading-dots" data-v-36864438><span class="dot" data-v-36864438></span><span class="dot" data-v-36864438></span><span class="dot" data-v-36864438></span></div></div>',1))])):k("",!0)])],512),s("div",de,[s("div",ue,[a(t(d),{circle:"",size:"small",class:"input-btn emoji-btn",style:{background:"transparent",border:"none",color:"#a5b4fc"},disabled:t(e).isStreaming},{default:l(()=>[a(t(u),{size:"18"},{default:l(()=>[a(t(W))]),_:1})]),_:1},8,["disabled"]),x(s("textarea",{"onUpdate:modelValue":n[0]||(n[0]=i=>t(e).inputContent=i),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜ï¼ŒæŒ‰å›è½¦å‘é€...",disabled:t(e).isStreaming,onKeydown:[z(M(w,["prevent"]),["enter"]),z(M(D,["shift"]),["enter"])],class:"message-input"},null,40,me),[[P,t(e).inputContent]]),s("div",ge,[a(t(d),{type:"primary",circle:"",size:"small",class:"send-btn",onClick:w,disabled:!t(e).inputContent.trim()||t(e).isStreaming,style:{background:"linear-gradient(135deg, #6366f1, #8b5cf6)",border:"none",width:"44px",height:"44px"}},{default:l(()=>[a(t(u),{size:"18"},{default:l(()=>[a(t(G))]),_:1})]),_:1},8,["disabled"]),a(t(d),{circle:"",size:"small",class:"clear-btn",onClick:t(e).clearChat,style:{background:"rgba(239,68,68,0.2)",border:"none",width:"44px",height:"44px",color:"#fca5a5"}},{default:l(()=>[a(t(u),{size:"18"},{default:l(()=>[a(t(T))]),_:1})]),_:1},8,["onClick"])])]),s("div",pe,[s("label",null,[x(s("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=i=>p.value=i),value:"dashscope",checked:"",disabled:""},null,512),[[U,p.value]]),n[5]||(n[5]=s("span",null,"é€šä¹‰åƒé—®",-1))])]),n[6]||(n[6]=s("div",{class:"tip-text"},"æ”¯æŒå›è½¦å‘é€ï¼ŒShift+å›è½¦æ¢è¡Œ",-1))])]))}}),xe=X(he,[["__scopeId","data-v-36864438"]]);export{xe as default};
